(function(t){function e(e){for(var n,r,o=e[0],l=e[1],c=e[2],f=0,h=[];f<o.length;f++)r=o[f],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&h.push(s[r][0]),s[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(h.length)h.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,o=1;o<i.length;o++){var l=i[o];0!==s[l]&&(n=!1)}n&&(a.splice(e--,1),t=r(r.s=i[0]))}return t}var n={},s={app:0},a=[];function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/choujiang/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},1237:function(t,e,i){},"2d3f":function(t,e,i){},"2e6f":function(t,e,i){"use strict";var n=i("1237"),s=i.n(n);s.a},"4df2":function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("f751"),i("097d");var n=i("2b0e"),s=i("8c4f"),a=i("b970"),r=(i("157a"),i("4eb5")),o=i.n(r),l=i("bc30"),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("TopNav"),i("transition",{attrs:{name:t.transitionName}},[i("router-view")],1)],1)},u=[],f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-sticky",[i("van-nav-bar",{attrs:{title:t.titleText,"right-text":t.buttonText,"left-arrow":"/"!==t.$route.path,"left-text":"/"!==t.$route.path?"返回":null},on:{"click-left":t.onClickLeft,"click-right":t.onClickRight}},["/"===t.$route.path?i("van-icon",{attrs:{slot:"right",name:"plus",size:"16px"},slot:"right"}):t._e()],1)],1)},h=[],p={data:function(){return{titleText:"",buttonText:""}},watch:{$route:function(t,e){this.routerSwitch(t,e)}},methods:{routerSwitch:function(t,e){switch(t.path){case"/":this.titleText="活动列表",this.buttonText="新建";break;case"/info":this.titleText="活动详情",this.buttonText="编辑";break;case"/info/add":this.titleText=this.$route.query.t?"编辑活动":"新建活动",this.buttonText=null;break}},onClickLeft:function(){this.$router.go(-1)},onClickRight:function(){switch(this.$route.path){case"/":this.$router.push({name:"info-add",query:{m:"add"}});break;case"/info":this.$router.push({name:"info-add",query:{m:"edit",t:this.$route.query.t}});break;case"/info/add":break}}},mounted:function(){this.routerSwitch({path:this.$route.path})}},d=p,v=i("2877"),m=Object(v["a"])(d,f,h,!1,null,null,null),j=m.exports,g={name:"app",components:{TopNav:j},data:function(){return{transitionName:""}},watch:{$route:function(t,e){t.meta.index>e.meta.index?this.transitionName="slide-left":this.transitionName="slide-right"}},mounted:function(){var t=this,e=window.localStorage.getItem("cjList");e?this.$vlf.setItem("cjl",JSON.parse(e)).then((function(t){window.localStorage.removeItem("cjList")})).catch((function(e){t.$toast.fail("初始化失败")})):this.$vlf.getItem("cjl").then((function(e){e||t.$vlf.setItem("cjl",{cjList:[]}).then((function(t){})).catch((function(e){t.$toast.fail("初始化失败")}))})).catch((function(e){t.$toast.fail("初始化失败")}))}},b=g,x=Object(v["a"])(b,c,u,!1,null,null,null),$=x.exports,k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cj-main"},[i("div",{staticClass:"wrap cj"},[i("p",{directives:[{name:"show",rawName:"v-show",value:t.cjList.length<=0,expression:"cjList.length <= 0"}],staticStyle:{"margin-top":"120px","text-align":"center",color:"rgb(193, 193, 193)","font-size":"14px"}},[t._v("暂无抽奖活动")]),t._l(t.cjList,(function(e,n){return i("van-panel",{key:n,staticClass:"cj-card",attrs:{title:e.title,desc:e.desc,status:0===e.status?"未开奖":e.zjUser.length+"人中奖"}},[i("div",{staticClass:"content-wrap",attrs:{slot:"default"},slot:"default"},[i("ul",{staticClass:"jp-list"},t._l(e.jpList,(function(e,n){return i("li",{key:n},[i("div",{staticClass:"i-span i-title"},[t._v(t._s(e.title))]),i("div",{staticClass:"i-span i-count"},[i("span",[t._v("x"+t._s(e.count))])])])})),0)]),i("div",{staticClass:"footer-wrap",attrs:{slot:"footer"},slot:"footer"},[i("span",{staticClass:"people-count"},[t._v(t._s(e.user.length)+"人参与")]),i("van-button",{attrs:{size:"small"},on:{click:function(i){return t.viewInfo(e.title)}}},[t._v(" 查看详情 ")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:0===e.status,expression:"item.status === 0"}],staticStyle:{"margin-left":"6px"},attrs:{size:"small",color:"linear-gradient(to right, #4bb0ff, #6149f6)"},on:{click:function(i){return t.viewInfo(e.title)}}},[t._v(" 立即开奖 ")])],1)])})),i("p",{staticClass:"setting"},[i("a",{directives:[{name:"show",rawName:"v-show",value:t.cjList.length>0,expression:"cjList.length > 0"}],staticClass:"btn",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.output()}}},[t._v("共"+t._s(t.cjList.length)+"个抽奖活动")])])],2)])},w=[],L=(i("3452"),{data:function(){return{cjList:[]}},methods:{viewInfo:function(t){this.$router.push({name:"info",query:{t:t}})},openJiang:function(){},input:function(){},output:function(){}},mounted:function(){var t=this;this.$vlf.getItem("cjl").then((function(e){t.cjList=e.cjList})).catch((function(e){t.cjList=[]}))}}),y=L,_=(i("2e6f"),Object(v["a"])(y,k,w,!1,null,null,null)),C=_.exports,U=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-tabs",{staticStyle:{width:"100%"},attrs:{color:"#258cf7"}},[i("van-tab",{attrs:{title:"活动信息"}},[i("van-cell-group",{attrs:{title:"基本信息"}},[i("van-cell",{attrs:{title:"活动名称",value:t.title}}),i("van-cell",{attrs:{title:"活动简介",value:t.desc}}),i("van-cell",{attrs:{title:"中奖名额",value:t.quota}}),i("van-cell",{attrs:{title:"开奖状态",value:0===t.status?"未开奖":"已开奖，"+t.zjUser.length+"人中奖"}})],1),t.status>0&&t.zjUser.length?i("van-cell-group",{attrs:{title:"中奖名单"}},t._l(t.zjUser,(function(t,e){return i("van-cell",{key:e,attrs:{title:t}})})),1):t._e(),i("van-cell",{staticStyle:{"margin-top":"3rem"},attrs:{title:0===t.status?"立即开奖":"重新开奖","title-style":"color: #1989fa; text-align: center;",center:"",clickable:""},on:{click:function(e){0===t.status?t.openJiang(!1):t.openJiang(!0)}}}),i("van-cell",{staticStyle:{"margin-top":"1rem","margin-bottom":"3rem"},attrs:{title:"删除活动","title-style":"color: #ee0a24; text-align: center;",center:"",clickable:""},on:{click:t.deleteCj}})],1),i("van-tab",{attrs:{title:"奖品信息 "+t.jpList.length}},[i("van-list",t._l(t.jpList,(function(t,e){return i("van-cell",{key:e,attrs:{title:t.title,value:"x"+t.count}})})),1)],1),i("van-tab",{attrs:{title:"参与用户 "+t.user.length}},[i("van-list",t._l(t.user,(function(e,n){return i("van-cell",{key:n},[i("div",[i("span",{staticStyle:{"margin-right":"10px","vertical-align":"middle"}},[t._v(t._s(e))]),t.status>0&&t.zjUser.includes(e)?i("van-tag",{attrs:{type:"success",plain:""}},[t._v("中奖")]):t._e()],1)])})),1)],1)],1)},q=[],I=(i("6762"),i("2fdb"),i("20d6"),i("7514"),{data:function(){return{title:"",desc:"",jpList:[],user:[],zjUser:[],quota:0,status:0,ing:!1}},mounted:function(){var t=this,e=[];this.$vlf.getItem("cjl").then((function(i){if(e=i.cjList,e.length<=0||"undefined"===typeof t.$route.query.t)t.$router.push("/");else{var n=e.find((function(e){return e.title===t.$route.query.t}));"undefined"!==typeof n?(t.title=n.title,t.desc=n.desc,t.jpList=n.jpList,t.user=n.user,t.zjUser=n.zjUser,t.quota=n.quota,t.status=n.status):t.$router.push("/")}})).catch((function(e){t.$router.push("/")}))},methods:{openJiang:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$dialog.confirm({title:e?"重新开奖确认":"开奖确认",message:e?"是否要重新开奖？":"是否要开奖？"}).then((function(){t.status=0,t.zjUser=[],t.ing=!0;var e=t.$toast.loading({duration:0,forbidClick:!0,loadingType:"circular",message:"系统开奖中\n剩余 5 秒"}),i=5,n=setInterval((function(){i--,i?e.message="系统开奖中\n剩余 ".concat(i," 秒"):(clearInterval(n),t.$toast.clear(),t.oj())}),1e3)})).catch((function(){}))},deleteCj:function(){var t=this;this.$dialog.confirm({title:"删除活动",message:"是否要删除这个活动？"}).then((function(){var e=[];t.$vlf.getItem("cjl").then((function(i){e=i.cjList;var n=e.findIndex((function(e){return e.title===t.title}));n>-1&&(e.splice(n,1),t.$vlf.setItem("cjl",{cjList:e}).then((function(e){t.$toast.success("删除成功"),t.$router.push("/")})).catch((function(e){t.$toast.success("删除失败")})))})).catch((function(e){t.$router.push("/")}))})).catch((function(){}))},oj:function(){var t=this;this.status=0,this.zjUser=[];var e=function e(){if(!(t.zjUser>=t.quota))for(var i=function(i){var n=t.user[t.rn(0,t.user.length-1)];if(t.zjUser.includes(n))return t.zjUser.splice(t.zjUser.findIndex((function(t){return n})),1),e(),"break";t.zjUser.push(n)},n=0;n<t.quota;n++){var s=i(n);if("break"===s)break}};e();var i=[];this.$vlf.getItem("cjl").then((function(e){i=e.cjList;var n=i.findIndex((function(e){return e.title===t.title}));n>-1&&(t.status=1,i[n].status=t.status,i[n].zjUser=t.zjUser,t.$vlf.setItem("cjl",{cjList:i}).then((function(e){t.$dialog.alert({message:'恭喜"'+t.zjUser.join("、")+'"中奖！'})})).catch((function(e){t.$toast.fail("开奖失败")})))})).catch((function(e){t.$toast.fail("开奖失败")}))},rn:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)}}}),z=I,S=Object(v["a"])(z,U,q,!1,null,null,null),T=S.exports,P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"wrap add"},[i("van-cell-group",{attrs:{title:"基本设置"}},[i("van-field",{attrs:{label:"活动名称",placeholder:"请输入活动名称",required:"",clearable:""},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),i("van-field",{attrs:{label:"活动简介",placeholder:"请输入活动简介",required:"",clearable:""},model:{value:t.desc,callback:function(e){t.desc=e},expression:"desc"}}),i("van-cell",{attrs:{title:"中奖名额"}},[i("van-stepper",{attrs:{max:"999","input-width":"30px","button-size":"22px"},model:{value:t.quota,callback:function(e){t.quota=e},expression:"quota"}})],1)],1),i("van-cell-group",{attrs:{title:"奖品设置"}},[t._l(t.jpList,(function(e,n){return i("van-swipe-cell",{key:n,ref:"jpItem"+n,refInFor:!0,attrs:{name:n,"on-close":t.onClose,"stop-propagation":!0,disabled:""}},[i("van-cell",{staticStyle:{padding:"0"}},[i("van-field",{ref:"vf"+n,refInFor:!0,attrs:{center:"",clearable:"",placeholder:"请输入奖品名称"},on:{focus:function(e){t.$refs["jpItem"+n][0].close()},"click-left-icon":function(e){return t.clickDel(t.$refs["jpItem"+n])}},model:{value:e.title,callback:function(i){t.$set(e,"title",i)},expression:"item.title"}},[i("van-icon",{staticStyle:{"margin-top":"-3px","margin-left":"-.5px","margin-right":"4.5px","vertical-align":"middle"},attrs:{slot:"left-icon","class-prefix":"iconfont",name:"icon-ios-remove-circle",color:"#ee0a24",size:"17px"},slot:"left-icon"}),i("van-stepper",{attrs:{slot:"button",max:"999","input-width":"30px","button-size":"22px"},slot:"button",model:{value:e.count,callback:function(i){t.$set(e,"count",i)},expression:"item.count"}})],1)],1),i("template",{slot:"right"},[i("van-button",{attrs:{square:"",type:"danger",text:"删除"}})],1)],2)})),i("van-cell",{attrs:{clickable:""},on:{click:t.addJp}},[i("template",{slot:"title"},[i("div",{staticClass:"ios-cell-button",attrs:{id:"__add"}},[i("van-icon",{staticClass:"b-icon",attrs:{name:"add"}}),i("span",{staticClass:"b-text"},[t._v("添加奖品")])],1)])],2)],2),i("van-cell-group",{attrs:{title:"参与用户设置"}},[i("van-field",{attrs:{type:"textarea",label:"参与用户",placeholder:"请输入参与用户（一行一个）",clearable:"",rows:"1",required:"",autosize:""},model:{value:t.user,callback:function(e){t.user=e},expression:"user"}}),t.cjList.length>0?i("van-cell",{attrs:{id:"_load_user",title:"从现有活动中导入...","title-style":t.cjList.length>0?"color: #1989fa;":"color: #ccc;",clickable:t.cjList.length>0},on:{click:t.loadCjUser}}):t._e(),i("van-popup",{attrs:{position:"bottom"},model:{value:t.showPicker,callback:function(e){t.showPicker=e},expression:"showPicker"}},[i("van-picker",{attrs:{"show-toolbar":"",title:"选择活动",columns:t.cjColumns,"default-index":0},on:{cancel:t.closeCjUserPicker,confirm:t.confirmCjUserPicker}},[i("van-cell-group",{attrs:{slot:"columns-bottom"},slot:"columns-bottom"},[i("van-switch-cell",{attrs:{title:"覆盖现有用户"},on:{change:t.isCoverUserChange},model:{value:t.isCoverUser,callback:function(e){t.isCoverUser=e},expression:"isCoverUser"}}),i("van-switch-cell",{attrs:{title:"过滤中奖用户"},model:{value:t.isFilterZjUser,callback:function(e){t.isFilterZjUser=e},expression:"isFilterZjUser"}})],1)],1)],1)],1),i("van-cell-group",{staticStyle:{margin:"3rem 0"}},[i("van-cell",{attrs:{title:t.isEdit?"确认修改":"确认创建","title-style":"color: #1989fa; text-align: center;",center:"",clickable:""},on:{click:t.save}})],1)],1)},O=[],E=(i("a481"),i("4917"),i("28a5"),i("3b2b"),i("7f7f"),{data:function(){return{title:"",desc:"",jpList:[{title:"",count:1}],user:"",quota:1,status:0,isEdit:!1,showPicker:!1,cjList:[],isCoverUser:!1,isFilterZjUser:!0}},computed:{cjColumns:function(){return this.cjList.map((function(t){return t.title}))}},mounted:function(){var t=this;this.$vlf.getItem("cjl").then((function(e){if(t.cjList=e.cjList,t.$route.query.t){t.isEdit=!0;var i=t.cjList.find((function(e){return e.title===t.$route.query.t}));i||t.$router.push("/"),t.title=i.title,t.desc=i.desc,t.jpList=i.jpList,t.user=i.user.join("\n"),t.quota=i.quota,t.status=i.status}else t.isEdit=!1})).catch((function(e){t.$router.push("/")}))},methods:{addJp:function(){var t=this;this.jpList.push({title:"",count:1}),setTimeout((function(){t.$refs["vf"+(t.jpList.length-1)][0].focus()}),10)},clickDel:function(t){t[0].open("right")},onClose:function(t,e,i){var n=this;switch(t){case"left":break;case"cell":break;case"outside":e.close();break;case"right":e.close(),setTimeout((function(){n.jpList.splice(i.name,1)}),600);break}},loadCjUser:function(){this.cjList.length<=0||(this.showPicker=!0)},isCoverUserChange:function(t){},closeCjUserPicker:function(){this.showPicker=!1},confirmCjUserPicker:function(t,e){var i=this.cjList.find((function(e){return e.title===t})),n=this.isFilterZjUser?i.user.filter((function(t){return!i.zjUser.includes(t)})):i.user;this.user=this.isCoverUser?n.join("\n"):this.user+(this.user?"\n":"")+n.join("\n"),this.showPicker=!1,this.$toast.success("导入成功"),setTimeout((function(){document.getElementById("_load_user").scrollIntoView()}),10)},save:function(){var t=this,e=this.jpList.filter((function(t){return t.title})),i=new RegExp(/[x|×|*][\d]+/g),n=new RegExp(/[\d]+/gi),s=this.user.split("\n");s&&(s=s.filter((function(t){return t})));for(var a=[],r=0;r<s.length;r++){var o=s[r].match(i)||[],l=o.length>0?o[0].match(n):null;if(o&&l){s[r]=s[r].replace(o[0],"");for(var c=0;c<l[0];c++)a.push(s[r]+" ("+(c+1)+")")}else a.push(s[r])}if(this.title)if(this.desc)if(e.length<=0)this.$toast("请添加奖品信息");else if(this.user&&s&&a)if(this.quota>s.length)this.$toast("中奖名额数不能大于参与用户的总数");else{if(this.isEdit){var u=this.cjList.findIndex((function(e){return e.title===t.$route.query.t}));if(!(u>-1))return void this.$toast.fail("修改失败");if(this.cjList[u].title!==this.title&&this.cjList.filter((function(e){return e.title===t.title})).length>=1)return void this.$toast.fail("活动已存在");this.cjList[u].title=this.title,this.cjList[u].desc=this.desc,this.cjList[u].quota=this.quota,this.cjList[u].jpList=e||this.jpList,this.cjList[u].user=a||s||[]}else{var f=this.cjList.findIndex((function(e){return e.title===t.title}));if(f>-1)return void this.$toast.fail("活动已存在");this.cjList.push({title:this.title,desc:this.desc,jpList:e||this.jpList,user:a||s||[],zjUser:[],quota:this.quota,status:this.status})}this.$vlf.setItem("cjl",{cjList:this.cjList}).then((function(e){t.$toast.success(t.isEdit?"修改成功":"创建成功"),t.$router.go(-1)})).catch((function(e){t.$toast.success(t.isEdit?"修改失败":"创建失败"),t.$router.go(-1)}))}else this.$toast("请添加参与用户");else this.$toast("请输入活动简介");else this.$toast("请输入活动名称")}}}),N=E,J=(i("7201"),Object(v["a"])(N,P,O,!1,null,null,null)),F=J.exports;n["a"].use(s["a"]);var M=new s["a"]({routes:[{path:"/",meta:{index:0,title:"活动列表"},component:C},{path:"/info",name:"info",meta:{index:1,title:"活动详情"},component:T},{path:"/info/add",name:"info-add",meta:{index:2,title:["新建活动","编辑活动"]},component:F}],scrollBehavior:function(t,e,i){return i||{x:0,y:0}}});i("f815"),i("2d3f");n["a"].config.productionTip=!1,n["a"].use(s["a"]),n["a"].use(a["a"]),n["a"].use(o.a),n["a"].use(l["a"]),new n["a"]({router:M,render:function(t){return t($)}}).$mount("#app")},7201:function(t,e,i){"use strict";var n=i("4df2"),s=i.n(n);s.a},f815:function(t,e,i){}});
//# sourceMappingURL=app.cbd8c485.js.map